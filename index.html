<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>EL VIGILANTE ‚Äì Inicio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="icon" href="data:,">
  <style>
    :root { --bg:#111; --fg:#fff; --mut:#bbb; --card:#171717; --border:#2a2a2a; }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--fg);min-height:100vh;display:flex;flex-direction:column}
    header{text-align:center;padding:18px}
    .logo{width:120px;margin-bottom:10px}
    h1{margin:6px 0 0}
    .menu{display:flex;flex-direction:column;gap:12px;align-items:center;margin:12px 0 24px}
    button{background:#333;color:#fff;border:none;border-radius:6px;padding:14px 22px;font-size:1.1rem;cursor:pointer;transition:.2s}
    button:hover{background:#555}
    .adminBtn{margin-top:6px;font-size:.95rem;padding:10px 16px;background:#222}
    .muted{color:var(--mut);font-size:.95rem}

    /* Admin panel */
    #adminPanel{display:none;flex:1;min-height:100vh;flex-direction:column}
    #adminHeader{display:flex;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--border);background:#0f0f0f}
    #btnBack{background:#222;padding:8px 12px;font-size:.95rem}
    .wrap{padding:12px 16px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    input,select{padding:10px;border-radius:8px;border:1px solid var(--border);background:#1b1b1b;color:#fff}
    #map{flex:1;min-height:60vh;margin:10px 16px;border-radius:10px;overflow:hidden;border:1px solid var(--border)}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#1b1b1b;margin-left:6px}
    .ok{color:#9fe29f}.warn{color:#ffd27a}.err{color:#ff8a8a}
    #adminMsg{margin:0 16px;color:#ffd27a}
    footer{color:var(--mut);text-align:center;padding:10px 0 18px}
  </style>
  <!-- Leaflet para el mapa de admin -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
</head>
<body>

  <!-- Vista VIGILADOR (p√∫blica) -->
  <header id="vigHeader">
    <img src="img/escudo.png" alt="Escudo" class="logo">
    <h1>EL VIGILANTE</h1>
    <p class="muted">Seleccion√° una opci√≥n</p>
  </header>

  <div id="vigMenu" class="menu">
    <button onclick="location.href='ingreso-salida.html'">üö™ Ingreso y Salida</button>
    <button onclick="location.href='rondas.html'">üìù Rondas</button>
    <button onclick="location.href='objetivo-mapa.html'">üìç Objetivo (Mapa √∫nico)</button>
    <button class="adminBtn" id="btnAdmin">üîí Ingresar como administrador</button>
  </div>

  <!-- Panel ADMIN (protegido por contrase√±a) -->
  <div id="adminPanel">
    <div id="adminHeader">
      <button id="btnBack">‚Üê Volver al men√∫</button>
      <div style="font-weight:600">Panel de administrador</div>
      <div id="adminMsg" class="muted"></div>
    </div>

    <div class="wrap">
      <div class="card">
        <div class="muted">Objetivo</div>
        <input id="objetivo" placeholder="Objetivo fijo" style="min-width:240px">
        <button id="btnAplicar">Aplicar</button>
      </div>

      <div class="card">
        <div class="muted">Auto-refresh</div>
        <select id="selInt">
          <option value="10000">10 s</option>
          <option value="15000" selected>15 s</option>
          <option value="30000">30 s</option>
          <option value="60000">60 s</option>
        </select>
        <div class="muted">Umbral sin se√±al: <b id="thLbl">40</b> min</div>
      </div>

      <div class="card">
        <div class="muted">Pines: <b id="count">0</b></div>
        <div class="muted">√öltima marca: <b id="last">‚Äî</b> <span id="lag" class="badge">‚Äî</span></div>
        <div class="muted">Estado: <b id="state" class="ok">OK</b></div>
      </div>
    </div>

    <div id="map"></div>
  </div>

  <footer>¬© EL VIGILANTE</footer>

<script>
/* ======= CONFIG ======= */
const WORKER_URL = "https://frosty-cake-3ccd.elvigilante_


